\subsection{AD-00-05: Full Stream Alert Distribution}
\label{ad-00-05}

\subsubsection{Requirements}

DMS-REQ-0002

\subsubsection{Test items}
\label{ad-00-05-items}

This test will check that the full stream of LSST alerts can be distributed to end users.

Specifically, this will demonstrate that:

\begin{itemize}

  \item{Serialized alert packets can be loaded into the alert distribution system at LSST-relevant scales;}
  \item{Alert packets can be retrieved from the queue system at LSST-relevant scales.}

\end{itemize}

This test does not include quantitative targets for latency.

\subsubsection{Intercase dependencies}

\begin{itemize}

  \item{\hyperref[ad-00-00]{AD-00-00}}

\end{itemize}

\subsubsection{Environmental needs}

\paragraph{Hardware}

The test shall be carried out on a machine with at least 64\,GB of RAM and
multiple CPU cores which has access to the \texttt{/datasets} shared (GPFS)
filesystem at the LSST Data Facility \textbf{or similar}.

\paragraph{Software}

The Kafka cluster and Zookeeper shall be instantiated according to the 
procedure described in \hyperref[ad-00-00]{AD-00-00}).

\subsubsection{Input specification}

A sample of Avro-formatted alert packets derived from LSST simulations corresponding to one night of simulated LSST observing.

This dataset shall be made available in \texttt{/datasets}.  \textbf{exact path}

\subsubsection{Output specification}

Multiple Kafka consumers will run and write log files to disk.  
The logs will include printing every \textbf{Nth} alert to to the log as well as a log summarizing the queue offset.

\subsubsection{Procedure}
\textbf{Maria to update instructions from alert stream readme}

\begin{enumerate}

	\item{Start a producer that reads alert packets from disk and loads them into the Kafka queue:   \texttt{docker run ....}}

	\item{Start a consumer that monitors the full stream and logs only End of Partition status messages:  \texttt{docker run....}}

	\item{Start a consumer that monitors the full stream and logs a deserialized version of every Nth packet:  \texttt{docker run ....}}

	\item{Examine output log files.  \textbf{Criteria for assessing whether things ran as expected.}}

\end{enumerate}
